# [4주차]idea_2팀_진행상황_공유

## 팀 구성원, 개인 별 역할

---

### 조예지 `PM`

- 질병 관리 기능
- JaCoCo 적용
- 모니터링 자료 이용한 레포트 쓰기 기능
- OAuth 일부 적용
- UI 만들기 : 반려동물, 모니터링 관리

### 김희정 `CTO`

- FCM & 이벤트로 푸시알람 기능 구현
    1. 일정 등록 시 알람(그룹원 모두에게)
    2. 일기 등록 시 알람(그룹원 모두에게)
    3. 그룹 초대 시 알람(초대받은 대상자만)
    4. 일정 부탁하기 시 알람(부탁받은 대상자만)
- 일정 부탁하기 API 구현
- 알람 entity 정의 및 알람 기록 저장
- Redis 새로 설치 & 암호화

### 조문주 `기획`

- 그룹 생성 UI 구현
- 로그인/로그아웃 프론트 기능 구현
- 그룹생성, 반려동물 등록 프론트 기능 구현

### 백승근 `인프라`

- Jenkins CI/CD 과정 빌드 에러 및 docker 용량 문제 해결
- SSL 인증 및 https 리다이렉트
- 도메인 주소 생성
- 스프링 부트 S3 연동 후 파일 업로드 및 삭제
- 일기 API 리팩토링

### 이상훈 `기획`

- UI 화면제작
- thymeleaf 사용해서 클라이언트와 DB 연결

### 김민경 `인프라`

- 일정 API 구현
- Jenkins를 이용한 CI/CD 구축

## 팀 내부 회의 진행 회차 및 일자

---

- 2023.02.04 : 대전 (불참인원 : 문주님(코로나))
- 2023.02.06 : 슬랙 허들 (불참인원 없음)
- 2023.02.07 : 슬랙 허들 (불참인원 : 예지님)
- 2023.02.08 : 슬랙 허들 (불참인원 없음)
- 2023.02.09 : 슬랙 허들 (불참인원 없음)
- 2023.02.10 : 슬랙 허들 (불참인원 없음)

## 현재까지 개발 과정 요약

---

### 조예지

- 하고 싶은 것이 많아서 기능들이 너무 많아졌다!
- JaCoCo 적용 후 테스트 커버리지를 보니 얼마나 더 작성해야할 지 자극이 왔다.
- UI 만들면서 JS를 익혀가고 있다.

### 이상훈

- 일기, 알림 UI 화면만 구현 (연동 X)
- 전체 일기 리스트 조회 연동, 페이징 처리
- 일기 작성 연동

### 백승근

- 인프라
    - Jenkins 빌드 과정, docker 에러, 용량 문제 발생
    - 리눅스를 잘 알지 못해 빠르게 해결하지 못한 에러들이 많았다
- 스프링 부트 S3 연동
    - 처음 접하는 기술이라 레퍼런스에 의존할 수 밖에 없었다
    - 다중 파일을 업로드 해야하기 때문에 List로 구현하는 과정이 어려웠다
    - 테스트 코드는 여전히 어렵다..
- 일기 API 리팩토링 ( ~ing)
    - Category → tag
    - 테스트 코드 완성 (ing)

### 김희정

- fcm 푸시알람 구현
    - 이벤트와 비동기 방식으로 구현하면서 왜 이벤트랑 비동기가 쓰이는지 공부할 수 있었다.
    - 프론트와 연동할 때 가장 최신 버전이 모듈로 구성되어있어서 연동하는데 어려웠다. 결국 이전 버전으로 라이브러리를 사용했다.
    - 웹 푸시 알람은 모바일과 달리 자료가 많이 없어서 어려웠다.
- 일정 부탁하기 API 구현
- 알람 entity 정의 및 알람 기록 저장
    - 여러 사람이 같은 알람을 갖게 되어서 알람 entity에서 받는 유저(receiver) 애트리뷰트가 다중값이 되었는데 테이블을 하나 더 정의해서 해당 문제를 해결했다.
- Redis 새로 설치 & 암호화
    - docker로 설치한 redis가 slave로 설정되어 자꾸 READONLY 문제가 발생해 redis를 새로 설치했다.
    - redis에 저장한 값들이 만료시간이 남았음에도 계속 사라졌는데 해킹당한 것이었다.^^.. 설정을 통해 암호를 걸어 해결했다.

### 김민경

- 일정 API CRUD 구현 완료
- 인프라
    - EC2 ↔ Jenkins ↔ GitLab 연동 완료
    - Nginx Blue/Green 무중단 배포 구현
    - certbot 설치하여 https 로 리다이렉트되게 구현
      → 구현 과정에서 EC2 주소가 아닌 도메인 주소가 필요하여 생성함
    - 용량 부족 문제로 인한 빌드 에러 → docker image 레이어드 용량 정리 후 해결
    - 인프라 블로그 작성 & 지속적인 용량 관리 진행 중

### 조문주

- 로그인
    - 로그인 성공시 localStorage에 accessToken을 저장
    - axios interceptor를 사용해서 서버에서 요청이 올 때마다 헤더에 토큰값을 넣어 인증
    - 로그인을 성공하고 토큰을 저장할 때 JSON parsing을 했더니 나중에 서버에 토큰을 전송할 때 Bearer “토큰값” ← 형태로 전송이 되어서 서명 불일치 오류가 났음
    - 서버에서 쿠키로 전송받은 refreshToken값과 클라이언트에 저장된 쿠키값이 달라서 인증 과정에서 오류가 났었지만 해결
- 로그아웃
    - 로그아웃 성공시 cookie와 localStorage를 비우고 로그인 페이지로 이동
    - 로그인 때와 마찬가지로 서버와 클라이언트 사이의 쿠키값이 달라서 오류가 났음

## 개발 과정에서 나왔던 질문

---

### 1. `/pets/{petId}/records`  {petId} 값을 주는 방법

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/11ba81d8-0d03-406e-a395-1aee3c3b5d0b/Untitled.png)

- 기존 사용 방법
    - **그룹을 생성하면서 위의 사진의 Session Storage에** `{groupId}`**를 넣어주어 정보를 계속 가지고 다니게 할 수 있다**. 펫을 등록할때 주소 `/api/v1/{groupId}/pets` 에 앞서 저장된 `{groupId}` 로 사용이 가능하다.
- 개선하고 싶은 방법
    - 위의 방법을 사용하면 일기 등록같은 경우는 `/api/v1/pets/{petId}/records` 에 `{petId}` 를 넣어줄때 펫을 등록할때 **Session Storage에 저장된 값만을 사용할 수 있다.** `{petId}` 를 다른 값을 넣고 싶을 때는 어떻게 해야할까?

### 2. EC2 용량 부족으로 빌드 에러 문제

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/531f0cc8-20ef-499a-8a04-45942f133470/Untitled.png)

### 3. redis READONLY 문제

[https://nebulous-purple-edf.notion.site/Redis-READONLY-163d2507e3c94e1da68fbaa47fc32909](https://www.notion.so/163d2507e3c94e1da68fbaa47fc32909)

## 개발 결과물 공유

---

📎 [Repository](https://gitlab.com/daengnyangffouchak/daily-daengnyang)

🖥 [블로그](https://daengnyangproject.tistory.com/)