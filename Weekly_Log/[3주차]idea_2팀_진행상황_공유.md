# [3주차]idea_2팀_진행상황_공유
## 팀 구성원, 개인 별 역할

---

### 조예지 `PM`

- 그룹, 모니터링, 태그 관련 기능 기획 및 개발

### 김희정 `CTO`

- 로그인 기능 구현
    - Refresh Token Rotation 으로 구현
    - refresh Token redis에 저장
- Redis Ec2에 띄우기
- 로그아웃 기능 구현

### 조문주 `기획`

- 회원가입, 로그인 프론트 연결
- 로그인/비로그인 화면 구분
- 반려동물 관리, 그룹관리 UI 구현

### 백승근 `인프라`

- Jenkins를 통한 CI/CD 과정
- 일기 API 구현 및 테스트코드
- 스프링 부트 s3 연동

### 이상훈 `기획`

- 반려동물 API 구현
- 메인피드 UI 작성

### 김민경 `인프라`

- Jenkins를 통한 CI/CD 과정
- 일정 API 구현 및 테스트코드

## 팀 내부 회의 진행 회차 및 일자

---

- 2023.01.29 : 슬랙 허들 (불참인원 없음)
- 2023.01.30 : 슬랙 허들 (불참인원 없음)
- 2023.01.31 : 슬랙 허들 (불참인원 없음)
- 2023.02.01 : 슬랙 허들 (불참인원 없음)
- 2023.02.02 : 슬랙 허들 (불참인원 없음)
- 2023.02.03 : 슬랙 허들 (불참인원 없음)

## 현재까지 개발 과정 요약

---

### 조예지

- 모니터링 및 태그 기능은 처음에 ERD나 요구사항정의서에서 구체적으로 계획하지 않았던 기능이라 기획도 같이 진행하였다. 그래서 구조를 생각하는 것이 어려웠다.
    - 모니터링은 처음에는 일기 엔티티에 포함되는 형식으로 하려고 하였으나, 굳이 그럴 필요가 없을 것 같아 분리시키고 모니터링 일자만 넣어주었다.
    - 모니터링 항목을 사용자가 직접 만들 수 있도록 하고 싶었으나, 아직은 구현이 복잡해질 것 같아 기본적인 항목들을 제공하는 모니터링 엔티티를 만들었다. 만약 질병이 추가되거나하면 모니터링 시트를 만드는 방법도 괜찮을 것 같았다. 하지만 추후에는 모니터링 항목을 직접 설정하고 관리할 수 있도록 하면 좋을 것 같다.
    - 태그와 관련해서는 팀원들과 상의하여 카테고리 필드를 없애고 태그를 카테고리처럼 사용하기로 하였다.
- 자주 쓰는 validation 메서드 Validator로 분리 및 적용

### 이상훈

- 반려동물 API 기능 구현 완성
- 수정사항 리팩토링
- 메인페이지 UI 레이아웃, table 잡기

### 백승근

- 일정 API 기능 구현 완성
- 컨트롤러 테스트 코드 중 실패 코드는 미완성
- 서비스 테스트코드 작성에 어려움
- 젠킨스 이용하여 CICD 구축은 Gitlab 프로젝트 저장소와 연동, gradle 빌드 되는것까지 확인한 상태이고 ubuntu 서버 환경 EC2와 연동하여 금일 중으로 배포까지 완료할 예정입니다
- 일기 기능에 그룹 내 일기만 조회가능 기능 추가 예정
- 파일 업로드 관련 s3연동 및 코드 작성중

### 김희정

- 로그인 기능 구현
    - access&refresh Token 둘 다 response
    - Refresh Token Rotation 으로 구현
    - refresh Token redis에 저장
    - refresh Token은 보안상 쿠키에 저장해서 클라이언트에 전송
- 토큰 재발급 api 구현
    - request : accessToken& refreshToken
    - refresh Token은 보안상 쿠키에 저장해서 클라이언트에 전송
- Redis Ec2에 띄우기
    - 환경변수로 springboot와 연동
- 로그아웃 기능 구현
    - redis를 활용해 블랙리스트 방식으로 구현하는 중

### 김민경

- 일정 API 기능 구현은 완료 했으나 Service 테스트 작성이 좀 어려워서 진행중에 있습니다.
- tag, 일정 전체 조회 관련 리팩토링이 있어서 진행 예정입니다.
- 젠킨스 이용하여 CICD 구축은 Gitlab 프로젝트 저장소와 연동, gradle 빌드 되는것까지 확인한 상태이고 ubuntu 서버 환경 EC2와 연동하여 금일 중으로 배포까지 완료할 예정입니다.

### 조문주

- `Valid` 어노테이션과 ajax를 활용해서 회원가입 데이터 유효성 검사 완성.
    - 컨트롤러와 JSON으로 데이터를 주고 받는 과정이 어려웠다.
- 반려동물 관리, 그룹관리  ui 페이지 완성.
- local storage에 access token을 저장하는 과정 진행 중. 저장이 될때도 있고 안 될때도 있어서 좀 더 찾아봐야 할것 같다.

## 개발 과정에서 나왔던 질문

---

### 1. Redis **READONLY You can't write against a read only replica. 에러**

`문제`

redis를 springboot와 연동하고 실행하던 중 redis가 갑자기 연결이 안되는 에러가 발생했다.

`해결과정`

**`READONLY You can't write against a read only replica` 라는 에러메세지가 나와 검색하니**

현재 내 redis가 slave여서 디폴트인 readonly 설정이 되어있어 값 수정이 안됐다. 터미널에서 readonly 상태를 바꿔서 해결했다.

`해결법`

`redis-cli -h 127.0.0.1 -p 6379 slaveof no one`


[https://github.com/redis/go-redis/issues/1643](https://github.com/redis/go-redis/issues/1643)

### 2. RefreshToken 언제 재발급할지

- Refresh Token 탈취 방지를 위해 Refresh Token Rotation 적용하는데, 언제 refresh Token을 재발급하는지 헷갈렸다.
    - 구글링했을 때 봤던 어떤 이미지에서는 accessToken이 만료되기전 주기적으로 재발급을 한다.
- 멘토님에게 Access Token 만료시 재발급해야한다고 답변을 들어서 그렇게 구현하기로 했다.

```jsx
- 로그인 시나리오
    1. 사용자가 만료된 accessToken으로 요청하면
    2. 서버가 검사를 통해서 만료된 토큰임을 확인
    3. 서버에서 사용자에게 만료되었으니 재발급을 위해 refreshToken 보내라고 응답 >> 401 상태코드
    4. 사용자는 재발급 위해 accessToken과 refreshToken 보냄
        - Q. refresh Token만 보내면 안되나?? >> accessToken이 조작될 가능성 있기 때문에 같이 보내서 유효성 검증 해야함
    5. 4번에서 보낸 refreshToken이 유효하면 재발급
```

### 3. ****물리삭제(hard delete)와 논리삭제(soft delete) 적용 이유****

- Api를 작성하면서 CRUD Api들에서는 논리삭제를하고 태그관련 Api에서는 물리삭제를 사용하고 있어 의문이 들었다.
- 코드리뷰시간에 팀원들에게 질문을 했고 목적에 맞게 사용해야한다고 답변을 받았다.

<aside>
❓ 물리삭제는 SQL의 DELETE 명령어를 사용하여 **직접 데이터를 삭제하는 방법**으로 DB에서 데이터를 날린다.

****하지만 삭제한 자료를 추후에 확인이 필요한 상황이라면  SQL의 명령어를 사용하여 **삭제 여부를 알수 있는 컬럼에 데이터가 삭제되었다는 값을 넣는 논리 삭제**를 구현해서 DB에 데이터를 보존여야 한다.

****대신 논리삭제는 그만큼 데이터가 보존되므로 **용량문제**에 주의가 필요하다.

</aside>

### 4. Tag 사용 어떻게 할지

- 카테고리 필드가 있었는데 이는 enum이라 사용자가 수정할 수 없다.
- 태그는 일기나 일정에 Fk로 넣어서 이를 카테고리처럼 이용하는 것으로 변경하였다.

### 5. entity에 wrapper class를 필드로 사용

- 필드타입으로 primate type인 boolean 값은 입력을 안 하면 `false`, int 값은 `0`으로 받아진다.

  **그러나 ‘입력을 하지 않아서 0이 나오는 것’과 ‘0을 입력하는 것’은 구분이 되어야할 것이다.**

- 이를 위해서는 1) 입력을 했는지를 체크하기 위해 column을 만드는 방법과 2) 입력하지 않았을 때 디폴트를 null로 받는 방법이 있을 것 같았다.

  2)번을 먼저 해보기 위해 로그를 찍었더니 request에서 body 값에 입력하지 않으면 boolean은 기본적으로 false로 받아지고 있었다.

- 아예 엔티티의 타입을 래퍼 클래스로 바꾸는 방법도 있었다. boolean → Boolean, int → Integer를 사용하면 body에 정보가 없으면 null값으로 들어오는 것을 확인하였다.
    - null 값을 받고 싶을 때는 Wrapper class로 타입을 설정하면 될 것 같다.

## 개발 결과물 공유

---

📎 [Repository](https://gitlab.com/daengnyangffouchak/daily-daengnyang)

🖥 [블로그](https://daengnyangproject.tistory.com/)