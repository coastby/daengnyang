<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:fragment="head">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <title>DAENG NYANG</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script type="text/javascript" th:src="@{/js/sign.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

  <!-- Bootstrap 5.2.3 Version, 반응형 햄버거 메뉴 -->
  <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- CSS -->
  <link th:href="@{/css/styles.css}" rel="stylesheet"/>
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>


</head>

<body>

<div th:fragment="header">

  <!-- Responsive navbar-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="margin-bottom: 20px;">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">DAENG NYANG</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarNavDarkDropdown" aria-controls="navbarNavDarkDropdown"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
        <ul class="login-on navbar-nav visually-hidden">
          <li class="nav-item"><a class="nav-link" th:href="@{/view/calendar}">캘린더</a></li>
          <li class="nav-item"><a class="nav-link" href="/">다이어리</a></li>
        </ul>
        <!-- 로그인 했을때 -->
        <ul class="login-on navbar-nav ms-auto mb-2 mb-lg-0 visually-hidden">
          <li class="nav-item"><a class="nav-link" aria-current="page" href="/">알람</a></li>

          <li class="nav-item"><a class="nav-link" href="/">오늘의 일정</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link" data-bs-toggle="dropdown" aria-expanded="false">마이페이지
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   class="bi bi-caret-down" viewBox="0 0 16 16">
                <path
                    d="M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659z"/>
              </svg>
            </a>
            <ul class="dropdown-menu">
              <li class="dropdown-item" onclick="location.href='/boards/list'">그룹 관리</li>
              <li class="dropdown-item" href="#">반려동물 관리</li>
              <li class="dropdown-item" href="#">찜 리스트</li>
              <li class="dropdown-item" onclick="logout()">로그아웃</li>
            </ul>
          </li>
        </ul>
        <!-- <li class="nav-item"><a class="nav-link" href="/users/login">로그인</a></li> -->

        <!-- 로그인 안 했을때 -->
        <ul id="logout-on" class="navbar-nav ms-auto mb-2 mb-lg-0" sec:authorize="isAnonymous()">
          <li class="nav-item"><a class="nav-link" th:href="@{/view/users/join}">회원가입</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/view/users/login}">로그인</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>

  <script th:inline="javascript">
    const token = localStorage.getItem("accessToken");
    $(document).ready(function () {
      if (token != null) {
        let ob = document.getElementsByClassName('login-on');
        for (let i = 0; i < ob.length; i++) {
          ob.item(i).classList.remove('visually-hidden');
        }

        document.getElementById('logout-on').classList.add('visually-hidden');
        firebaseModule.init()

      }
    });
    let firebaseConfig = {
      apiKey: "AIzaSyCUnOt-IbJVa8XIXm4wU_097CLWGSFFKA0",
      authDomain: "daengnyang-e1df7.firebaseapp.com",
      projectId: "daengnyang-e1df7",
      storageBucket: "daengnyang-e1df7.appspot.com",
      messagingSenderId: "685788055963",
      appId: "1:685788055963:web:e6e38b48dd874d7d80393e",
      measurementId: "G-98R8NEJEF1"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Show Notification
    // 메시지 기능 활성화를 알림
    const messaging = firebase.messaging();
    // RequestPermission 첫 어플 시작 시 알림 허용 or 불허를 사용자에게 안내합니다.
    // 허용하지 않을 시 알람 메시지는 가지 않습니다.
    messaging.requestPermission()
    .then(function() {
      // 알람이 허용되었을 때 토큰을 반환합니다.
      // 해당 토큰을 통해 FCM 특정 사용자에게 메시지를 보낼 수 있습니다.
      return messaging.getToken();
    })
    .then(async function(token) {
      console.log(token);
      // 해당 onMessage는 데이터메시지로, 포그라운드인 상태에서
      // FCM 메시지를 전송하는 경우 콘솔에 표기하도록 작성된 코드입니다.

      messaging.onMessage(payload => {
        console.log(payload);

      })
    })

 </script>
</div>


</body>
</html>
